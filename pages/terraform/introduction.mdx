import Bleed from 'nextra-theme-docs/bleed'
import Callout from 'nextra-theme-docs/callout'

# Terraform

## O que √©?

O Terraform √© uma ferramenta de provisionamento de infraestrutura como c√≥digo, 
ou seja, √© uma ferramenta que permite que voc√™ crie, altere e exclua recursos de 
infraestrutura de forma automatizada e idempotente. 

O Terraform √© uma ferramenta 
de c√≥digo aberto e multiplataforma, ou seja, voc√™ pode utiliz√°-lo em qualquer sistema 
operacional.

## Integra√ß√µes com o Terraform

O Terraform possui integra√ß√µes com os principais provedores de nuvem, como
AWS, Azure, Google Cloud, Digital Ocean, entre outros. Al√©m disso, ele tamb√©m
possui integra√ß√µes com ferramentas de gerenciamento de configura√ß√£o, como
Ansible, Chef, Puppet, entre outros.

<Callout emoji="üìö" title="Refer√™ncias">
  1851 empresas supostamente usam o Terraform em seus stacks de tecnologia, incluindo Uber, Udemy e Instacart.
</Callout>

## Estrutura de um projeto Terraform

O Terraform utiliza um arquivo chamado `main.tf` para definir os recursos que
ser√£o provisionados. Esse arquivo √© escrito em uma linguagem chamada HCL (HashiCorp
Configuration Language), que √© uma linguagem de configura√ß√£o declarativa.

<Callout emoji="üìö" title="Refer√™ncias">
  A linguagem HCL √© baseada no JSON e no YAML.
</Callout>

### Exemplo de um arquivo main.tf

```hcl
provider "aws" {
  region = "us-east-1"
  access_key = var.aws_access_key
  secret_key = var.aws_secret_key
}

resource "aws_instance" "example" {
  ami           = "ami-0c55b159cbfafe1f0"
  instance_type = "t2.micro"
}
```

O arquivo acima cria uma inst√¢ncia EC2 na regi√£o `us-east-1` com a imagem
`ami-0c55b159cbfafe1f0` e o tipo `t2.micro`.


## V√°riaveis de ambiente

O Terraform possui uma funcionalidade chamada `vari√°veis de ambiente`, que
permite que voc√™ defina vari√°veis que ser√£o utilizadas no arquivo `main.tf` (como representado no [exemplo](introduction#exemplo-de-um-arquivo-maintf) dado a cima). 

Essas
vari√°veis podem ser definidas em um arquivo chamado `terraform.tfvars`, que deve
ser criado na raiz do projeto Terraform.

<Callout emoji="üìù">
  <strong>Observa√ß√£o:</strong> O arquivo <code>terraform.tfvars</code> n√£o deve ser
  versionado, pois ele cont√©m informa√ß√µes sens√≠veis, como chaves de acesso.
</Callout>

### Exemplo de um arquivo terraform.tfvars

```hcl
aws_access_key = "AKIAIOSFODNN7EXAMPLE"
aws_secret_key = "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
```

## Workspaces

O Terraform possui uma funcionalidade chamada `workspaces`, que permite que voc√™
crie ambientes de forma isolada. Por exemplo, voc√™ pode criar um workspace para
cada ambiente (dev, staging, prod, etc).

Como citado acima, workspaces no terraform s√£o uma forma de organizar seus arquivos de configura√ß√£o.
Eles s√£o uma forma de agrupar recursos que fazem sentido juntos, como por exemplo, um ambiente de desenvolvimento, um ambiente de produ√ß√£o.

No nosso caso, utilizamos workspaces para separar as regi√µes onde os recursos ser√£o criados, como por exemplo, `us-east-1` e `us-east-2`, ou 
`global` no caso de recursos que n√£o precisam de regi√£o como **IAM** para a cria√ß√£o de usu√°rios e grupos de usu√°rios.

<Callout emoji="‚ö†Ô∏è">
    Se n√£o criassemos workspaces ou qualquer outra forma de separar os arquivos de configura√ß√£o, ao executar o comando `terraform apply` 
    o terraform iria tentar criar todos os recursos em apenas uma regi√£o, j√° que o recurso `providers.tf` que configura a regi√£o da **VPC** 
    n√£o aceita realizar loops (como o `for_each`, que ser√° explicado na [proxima sess√£o](module-template)) para
    criar recursos em m√∫ltiplas regi√µes.
</Callout>